try{var cX=window.cX=window.cX||{};cX.callQueue=cX.callQueue||[];cX.CCE=cX.CCE||{};cX.CCE.callQueue=cX.CCE.callQueue||[];if(!cX.CCE.library){cX.CCE.library={version:"2.11",ccePushUrl:"https://comcluster.cxense.com/cce/push?callback={{callback}}&experimental=true",prefix:null,persistedQueryId:null,testGroup:-1,testVariant:null,previewTestId:null,previewCampaign:null,previewDiv:null,previewId:null,startTime:new Date,visibilityField:"timeHalf",trackTime:.5,noCache:false,activeSnapPoint:null,snapPoints:[],activeWidgets:[],sendPageViewEvent:function(prefix,persistedQueryId,args,callback){this.init(null,prefix,persistedQueryId,this.visibilityField,function(){cX.sendPageViewEvent(args,callback)})},init:function(scriptPattern,prefix,persistedQueryId,visibilityField,callback){this.prefix=prefix;this.persistedQueryId=persistedQueryId;var params={};if(scriptPattern){var scripts=document.getElementsByTagName("script");var script=null;for(var i=0;!script&&i<scripts.length;++i){if(scripts[i]&&scripts[i].src&&scripts[i].src.indexOf(scriptPattern)>-1){script=scripts[i]}}if(script&&script.src&&script.src.indexOf("#")>-1){var searchPart=script.src.replace(/.*#/,"");params=cX.decodeUrlEncodedNameValuePairs(searchPart)}}var args=cX.parseUrlArgs();this.testVariant=args.testVariant||params.testVariant||params.ver;this.previewTestId=args.testId||params.testId;this.previewCampaign=args.previewCampaign||params.previewCampaign;this.previewDiv=args.previewDiv||params.previewDiv||"current";this.previewId=args.previewId||params.previewId;this.noCache=args.cx_nocache==="1"||params.cx_nocache==="1";if(this.testGroup===-1){this.testGroup=this.getTestGroup()}if(this.prefix&&this.persistedQueryId){cX.setEventAttributes({origin:this.prefix+"-web",persistedQueryId:this.persistedQueryId})}cX.setCustomParameters({ver:this.version,testGroup:this.testGroup});var delay=(new Date-this.startTime)/1e3;if(visibilityField&&visibilityField.length){this.visibilityField=visibilityField}if(delay>2){cX.setCustomParameters({loadDelay:delay.toFixed(1)})}this._insertPreview();if(callback){callback()}},setVisibilityField:function(visibilityField){this.visibilityField=visibilityField},setSnapPoints:function(viewPorts){this.snapPoints=viewPorts;this.activeSnapPoint=this._getSnapPoint();var t;window.addEventListener("resize",function(){clearTimeout(t);t=setTimeout(cX.createDelegate(this,function(){this._renderResizedWidgets()}),200)},false)},_getSnapPoint:function(){var v=this.snapPoints;if(!v.length){return""}var width=cX.getWindowSize().width;for(var i=0;i<v.length;++i){if(width>=v[i].min){return v[i].name}}return v[v.length-1].name},_renderResizedWidgets:function(){var newSnap=this._getSnapPoint();if(newSnap!==this.activeSnapPoint){this.activeSnapPoint=newSnap;for(var i=0;i<this.activeWidgets.length;++i){var w=this.activeWidgets[i];w.context.activeSnapPoint=newSnap;var element=document.getElementById(w.templateId);if(!element){this._addTemplate(w.templateId,w.templateContent)}cX.renderTemplate(w.templateId,w.targetId,w.data,w.context)}}},getTestGroup:function(){var cxId=cX.getUserId();var newBucket=-1;if(cxId&&cxId.length){var newHash=0;for(var i=0;i<cxId.length;i++){newHash=(newHash<<5)-newHash+cxId.charCodeAt(i);newHash|=0}newBucket=Math.abs(newHash)%100}else{newBucket=Math.floor(Math.random()*100)}return newBucket},_applyContext:function(context,widgetParams){if(!context){context={}}if(!context.context){context.context={}}if(!context.context.categories){context.context.categories={}}if(!context.context.parameters){context.context.parameters=[]}var newContextCategories={};cX.Object.forEach(context.context.categories,function(value,key){if(value!==undefined){var found=false;var k=key.toLowerCase();newContextCategories[k]=value;cX.Object.forEach(context.context.parameters,function(param){found=found||param.key===k});if(!found){context.context.parameters.push({key:k,value:""+value})}}});context.context.categories=newContextCategories;if(this.previewId===widgetParams.widgetId&&this.previewCampaign){context["tag"]=this.previewCampaign}if(this.testGroup===-1){this.testGroup=this.getTestGroup()}context.context.categories.testgroup=""+this.testGroup;context.context.parameters.push({key:"testgroup",value:""+this.testGroup});if(widgetParams&&widgetParams.targetElementId){var element=document.getElementById(widgetParams.targetElementId);if(element){var uniqueLinks={};var links=[].slice.call(element.querySelectorAll(widgetParams&&widgetParams.ctrlLinksCss||"a"));for(var i=0;i<links.length;i++){var link=links[i];var linkValue=this._getElemLink(link,widgetParams&&widgetParams.ctrlSpaAttr);if(link&&linkValue){uniqueLinks[linkValue]=null}}var index=1;for(var uniqueLink in uniqueLinks){if(uniqueLinks.hasOwnProperty(uniqueLink)){context.context.parameters.push({key:"ctrlUrl"+index++,value:uniqueLink})}}}}if(this.noCache){context.context.uncachedSettings=true}return context},reportTestImpression:function(testId,testVariant){if(testId!==null){cX.sendEvent("imp",{testId:""+testId,testVariant:testVariant})}},_reportWidgetVisible:function(testId,testVariant,items){cX.sendEvent("widgetVisible",{testId:""+testId,testVariant:testVariant});for(var i=0;i<items.length;++i){var item=items[i];if(item.click_url){var requestObject={impressions:[{clickUrl:item.click_url,visibilitySeconds:1}]};var url="https://api.cxense.com/public/widget/visibility?callback={{callback}}"+"&json="+encodeURIComponent(cX.JSON.stringify(requestObject));cX.jsonpRequest(url,function(result){},{synchronous:false})}}},trackVisibility:function(divId,testId,testVariant,items){var element=document.getElementById(divId);if(!element){return}if(testId!==null&&items){var trackedId=divId;var elements=element.getElementsByClassName("cx-visibility-element");if(elements&&elements.length===1){if(elements[0].id){trackedId=elements[0].id}}cX.trackElement({elementId:trackedId,trigger:{on:cX.createDelegate(this,function(state){return state.visibility[this.visibilityField]>=this.trackTime}),callback:cX.createDelegate(this,function(state){this._reportWidgetVisible(testId,testVariant,items)})}})}},_instrumentClickLinks:function(widgetParams,testId,testVariant,items){var divId=widgetParams&&widgetParams.targetElementId;var ctrlLinksCss=widgetParams&&widgetParams.ctrlLinksCss||"a";var ctrlSpaAttr=widgetParams&&widgetParams.ctrlSpaAttr;var element=document.getElementById(divId);if(!element){return}var links=[].slice.call(element.querySelectorAll(ctrlLinksCss)).filter(cX.createDelegate(this,function(elem){return this._getElemLink(elem,ctrlSpaAttr)}));for(var i=0;i<links.length;++i){var link=links[i];var linkValue=this._getElemLink(link,ctrlSpaAttr);var instrumented=false;if(items){for(var j=0;j<items.length;++j){var item=items[j];if(item.click_url&&linkValue===item.url){this._ctrlClickTracker(item.click_url,link,ctrlSpaAttr);instrumented=true;break}}}if(!instrumented){var urlData="cx_testId="+encodeURIComponent(testId)+"&cx_testVariant="+encodeURIComponent(testVariant);linkValue+=(linkValue.indexOf("#")<0?"#":"&")+urlData+"&cx_artPos="+i;if(ctrlSpaAttr){link.setAttribute(ctrlSpaAttr,linkValue)}else{link.href=linkValue}}}},instrumentClickLinks:function(divId,testId,testVariant){this._instrumentClickLinks({targetElementId:divId},testId,testVariant)},_getElemLink:function(elem,ctrlLinkAttribute){if(ctrlLinkAttribute){return elem.getAttribute(ctrlLinkAttribute)}return elem.href},_updateClickUrls:function(items){if(items){for(var i=0;i<items.length;++i){var item=items[i];if(item.click_url){if(!this._isEmptyType(item.type)){var testId=item.testId||"0";var testVariant=item.type==="ctrl"?"ctrl":"cx_"+(item.campaign||0);item.click_url+="?cx_testId="+testId+"&cx_testVariant="+testVariant+"&cx_artPos="+i;if(item.tag){item.click_url+="&cx_tag="+item.tag}if(item._type){item.click_url+="&cx_type="+item._type}}}}}},updateRecsClickUrls:function(testId,testVariant,items){if(items){for(var i=0;i<items.length;++i){var item=items[i];if(item.click_url){item.click_url+="?cx_testId="+testId+"&cx_testVariant="+testVariant+"&cx_artPos="+i;if(item.tag){item.click_url+="&cx_tag="+item.tag}}}}},_ctrlClickTracker:function(clickUrl,linkElem,spaSupport){if(!spaSupport){return cX.clickTracker(clickUrl,linkElem)}else{window.requestAnimationFrame(function(){cX.addEventListener(linkElem,"click",function(){cX.sendSpaRecsClick(clickUrl)})})}},clickTracker:function(item,callback){var linkId="cXLinkId"+cX.library._randomString();if(item&&item.click_url){if(!callback){return cX.clickTracker(item.click_url)}else{window.requestAnimationFrame(function(){var linkEl=document.getElementById(linkId);cX.addEventListener(linkEl,"mousedown",function(){linkEl.removeAttribute("href")});cX.addEventListener(linkEl,"touchstart",function(){linkEl.removeAttribute("href")});cX.addEventListener(linkEl,"click",function(){cX.sendSpaRecsClick(item.click_url,function(){callback(item)})})})}}else if(item&&item.clickUrl){if(item.contentItem&&item.contentItem.click_url){var clickUrl=item.contentItem.click_url;window.requestAnimationFrame(function(){var linkEl=document.getElementById(linkId);cX.addEventListener(linkEl,"mousedown",function(){linkEl.removeAttribute("href")});cX.addEventListener(linkEl,"touchstart",function(){linkEl.removeAttribute("href")});cX.addEventListener(linkEl,"click",function(){cX.sendSpaRecsClick(clickUrl,function(){if(callback){callback(item)}else{window.location.href=item.clickUrl}})})})}else{return cX.clickTracker(item.clickUrl)}}return linkId},getDivId:function(className){if(className&&className.length){var testCandidates=document.getElementsByClassName(className);if(testCandidates&&testCandidates.length===1){var div=testCandidates[0];if(!(div.id&&div.id.length)){div.id=className+"-01"}return div.id}}return null},_processResult:function(widgetParams,items){if(items&&items.length){var item=items[0];if(!this._isEmptyType(item.type)){var testId=item.testId||"0";var testVariant=item.type==="ctrl"?"ctrl":"cx_"+(item.campaign||0);this.reportTestImpression(testId,testVariant);if(item.type==="ctrl"){this._instrumentClickLinks(widgetParams,testId,testVariant,items)}this.trackVisibility(widgetParams&&widgetParams.targetElementId,testId,testVariant,items)}}},processCxResult:function(testId,divId){var element=document.getElementById(divId);if(!element){return}this.reportTestImpression(testId,"cx");var cxDivId=null;if(element.previousElementSibling){cxDivId=element.previousElementSibling.id;if(element.className==="template"){element.parentNode.removeChild(element)}}this.trackVisibility(cxDivId||divId,testId,"cx")},_isEmptyType:function(type){return["noImpact","noVisual","free"].indexOf(type)>=0},_isIgnoredResponse:function(data){if(data&&data.response&&data.response.items&&data.response.items.length){return this._isEmptyType(data.response.items[0].type)}return true},_isAdResponse:function(data){if(data&&data.response&&data.response.items&&data.response.items.length){var item=data.response.items[0];return item.type==="personalized"&&item.adSpaceId&&item.adTargetingKeywords}return false},_addTemplate:function(divId,content){var templ=document.createElement("div");templ.id=divId;templ.className="template";templ.setAttribute("style","display: none;");templ.innerHTML=content;document.body.appendChild(templ)},displayResult:function(divId,data,context){if(data.response.items&&data.response.items.length){if(data.response.items[0].type==="ctrl"){return}}var template=data.response.template;var rawStyle=data.response.style;var rawCode=data.response.head;if(rawStyle&&rawStyle.length){var style=document.createElement("style");style.type="text/css";if(style.styleSheet){style.styleSheet.cssText=rawStyle}else{style.appendChild(document.createTextNode(rawStyle))}document.getElementsByTagName("head")[0].appendChild(style)}if(rawCode&&rawCode.length){var codeObj=document.createElement("script");codeObj.type="text/javascript";codeObj.text=rawCode;document.getElementsByTagName("head")[0].appendChild(codeObj)}var templateDiv="cx-"+cX.getRandomString()+"-tmp";this._addTemplate(templateDiv,template);var target=divId?divId:templateDiv+"-dst";if(!divId){var dest=document.createElement("div");dest.id=templateDiv+"-dst";dest.className="template";dest.setAttribute("style","display: none;");document.body.appendChild(dest)}if(this.snapPoints.length){if(!context){context={}}context.activeSnapPoint=this._getSnapPoint();this.activeWidgets.push({templateId:templateDiv,targetId:target,data:data,context:context,templateContent:template})}cX.renderTemplate(templateDiv,target,data,context)},runCxVersion:function(testId,divId,widgetParams,context,callback){if(widgetParams.renderTemplateUrl){widgetParams.insertBeforeElementId=divId;widgetParams.testId=testId;widgetParams.testVariant="cx";widgetParams.onImpressionResult=cX.createDelegate(this,function(){this.processCxResult(testId,divId,context);if(callback){callback()}})}else{if(!widgetParams.renderFunction){widgetParams.renderFunction=cX.createDelegate(this,function(data,context){if(testId){this.updateRecsClickUrls(testId,"cx",data.response.items)}this.displayResult(divId,data);this.processCxResult(testId,divId);if(callback){callback(data,context)}})}else{var origRenderFunc=widgetParams.renderFunction;widgetParams.renderFunction=cX.createDelegate(this,function(data,context){this.updateRecsClickUrls(testId,"cx",data.response.items);this.processCxResult(testId,divId);origRenderFunc(data,context);if(callback){callback(data,context)}})}}context=this._applyContext(context,widgetParams);cX.insertWidget(widgetParams,context)},displayWidget:function(divId,widgetParams,context,callback){this.runCxVersion(null,divId,widgetParams,context,callback)},runCtrlVersion:function(testId,divId,callback){this.reportTestImpression(testId,"ctrl");this.instrumentClickLinks(divId,testId,"ctrl");this.trackVisibility(divId,testId,"ctrl");if(callback){setTimeout(callback,1)}},runTest:function(testId,divId,testSize,widgetParams,context,callback){if(this.testVariant==="cx"){this.runCxVersion(testId,divId,widgetParams,context,callback)}else if(this.testVariant==="ctrl"){this.runCtrlVersion(testId,divId,callback)}else if(this.testGroup>-1&&testSize>0){if(this.testGroup<testSize*100){this.runCxVersion(testId,divId,widgetParams,context,callback)}else if(this.testGroup>100*(1-testSize)){this.runCtrlVersion(testId,divId,callback)}}else if(callback){setTimeout(callback,1)}},_renderFunction:function(data,context,widgetParams,callback){if(!this._isIgnoredResponse(data)){this._updateClickUrls(data.response.items);this.displayResult(widgetParams&&widgetParams.targetElementId,data);this._processResult(widgetParams,data.response.items)}this._executeCallback(callback,data,context)},render:function(targetDiv,data,context,callback){this._renderFunction(data,context,{targetElementId:targetDiv},callback)},_executeCallback:function(callback,data,context){if(callback){if(typeof callback==="function"){callback(data,context)}else if(typeof callback==="string"){if(window[callback]&&typeof window[callback]==="function"){window[callback](data,context)}else{var functionName="cx_"+cX.getRandomString();var codeObj=document.createElement("script");codeObj.type="text/javascript";codeObj.text="function "+functionName+"(data,context) {("+callback+")(data,context);}";document.getElementsByTagName("head")[0].appendChild(codeObj);if(window[functionName]&&typeof window[functionName]==="function"){window[functionName](data,context)}}}}},run:function(widgetParams,context,callback){widgetParams.renderFunction=cX.createDelegate(this,function(data,context){if(this._isAdResponse(data)){var resp=data.response;var item=resp.items[0];var requestBody={adSpaceId:item.adSpaceId,initialHorizontalAdUnits:1,initialVerticalAdUnits:1,k:item.adTargetingKeywords,renderFunction:cX.createDelegate(this,function(data){var ad=this.cxad.getAd(data);if(ad){ad.contentItem=item;this._renderFunction({response:{template:resp.template,style:resp.style,head:resp.head,items:[ad]}},context,widgetParams,callback)}})};cX.insertAdSpace(requestBody)}else{this._renderFunction(data,context,widgetParams,callback)}});context=this._applyContext(context,widgetParams);cX.insertWidget(widgetParams,context)},_runDuplicateRemoval:function(widgets,duplicateRemovalKey,alreadyDisplayed){if(widgets.length>0){var currWidget=widgets.shift();if(!currWidget.widgetContext){currWidget.widgetContext={}}if(!currWidget.widgetContext.context){currWidget.widgetContext.context={}}currWidget.widgetContext.context.neighbors=alreadyDisplayed;if(widgets.length>0){this.run(currWidget.widgetParams,currWidget.widgetContext,cX.createDelegate(this,function(data,context){if(data&&data.response&&data.response.items&&data.response.items.length){for(var i=0;i<data.response.items.length;i++){var item=data.response.items[i];if(duplicateRemovalKey in item){var artId=item[duplicateRemovalKey];if(alreadyDisplayed.indexOf(artId)===-1){alreadyDisplayed.push(artId)}}}this._executeCallback(currWidget.widgetCallback,data,context)}this._runDuplicateRemoval(widgets,duplicateRemovalKey,alreadyDisplayed)}))}else{this.run(currWidget.widgetParams,currWidget.widgetContext,currWidget.widgetCallback)}}},runMulti:function(widgets,duplicateRemovalKey){if(!duplicateRemovalKey){for(var i=0;i<widgets.length;i++){this.run(widgets[i].widgetParams,widgets[i].widgetContext,widgets[i].widgetCallback)}}else{var alreadyDisplayed=[];this._runDuplicateRemoval(widgets,duplicateRemovalKey,alreadyDisplayed)}},insertMaster:function(widgetId,context,duplicateRemovalKey){cX.insertWidget({widgetId:widgetId,renderFunction:cX.createDelegate(this,function(data){if(data&&data.response&&data.response.items&&data.response.items.length){var item=data.response.items[0];var widgets=[];if(item&&item.widgets){for(var w=0;w<item.widgets.length;w++){var widget=item.widgets[w];if(widget.widgetId&&widget.targetElementId){widgets.push({widgetParams:{widgetId:widget.widgetId,targetElementId:widget.targetElementId},widgetContext:context,widgetCallback:widget.callback})}}}this.runMulti(widgets,duplicateRemovalKey)}})},context)},_insertPreview:function(){if(this.previewId&&this.previewDiv!=="current"){if(this.previewDiv==="new"){var div=document.createElement("div");this.previewDiv="cx_preview_"+cX.getRandomString();div.setAttribute("id",this.previewDiv);document.body.insertBefore(div,document.body.firstChild)}this.run({widgetId:this.previewId,targetElementId:this.previewDiv})}},setTestGroup:function(testGroup){this.testGroup=testGroup},invoke:function(func){func.apply(window,Array.prototype.slice.call(arguments,1))},sendConversionEvent:function(conversionParams,options){if(cX.library._doesNotHaveConsent("pv"))return;options=options||{};var identities=options.identities||[];if(!cX.Array.some(identities,function(id){return id.type==="cx"})){identities.push({id:cX.getUserId(),type:"cx"})}var requestObject={events:[Object.assign(conversionParams||{},{eventType:"conversion",siteId:cX.library.m_siteId,userIds:identities,consent:cX.library.m_usesConsent?cX.library._allUserConsentsList():undefined})]};var url=this.ccePushUrl+"&json="+encodeURIComponent(cX.JSON.stringify(requestObject));cX.jsonpRequest(url,function(result){if(options.callback){options.callback(result,{url:url,request:requestObject})}})}};(function(d,s,e,t){e=d.createElement(s);e.type="text/java"+s;e.async="async";e.src="http"+("https:"===location.protocol?"s://s":"://")+"cdn.cxense.com/cx.js";t=d.getElementsByTagName(s)[0];t.parentNode.insertBefore(e,t)})(document,"script")}if(!cX.CCE.cxad){cX.CCE.cxad={isRetina:false,getContent:function(ad,key,defaultValue){if(ad.creative&&ad.creative.content&&ad.creative.content.length){var contents=ad.creative.content;for(var k=0;k<contents.length;k++){var content=contents[k];if(content.key===key){return content.value[0]}}}return defaultValue||""},getImage:function(ad,key){var posts=[""];if(this.isRetina){posts=[" retina",""]}for(var ix in posts){var p=posts[ix];if(ad.creative&&ad.creative.images&&ad.creative.images.length){var images=ad.creative.images;var lowerKey=key.toLowerCase();for(var k=0;k<images.length;k++){var image=images[k];var actualKey=image.key.toLowerCase();if(actualKey===lowerKey+p){return image.source}}}}return""},getAd:function(data){if(data&&data.searchResult&&data.searchResult.spaces&&data.searchResult.spaces[0]&&data.searchResult.spaces[0].ads){var adSpace=data.searchResult.spaces[0];if(adSpace.ads.length>=1){return adSpace.ads[0]}}return null}}}function cxCCE_callQueueExecute(){try{var currCall=null;while(currCall=cX.CCE.callQueue.shift()){try{var fnName=currCall[0];var fnArgs=currCall.slice(1);cX.callQueue.push(["invoke",function(localName,localArgs){return function(){cX.CCE.library[localName].apply(cX.CCE.library,localArgs)}}(fnName,fnArgs)])}catch(e){}}}catch(e){}}setTimeout(cxCCE_callQueueExecute,25);cX.CCE.callQueue.push=function(){Array.prototype.push.apply(this,arguments);setTimeout(cxCCE_callQueueExecute,1);return this.length};(function(){for(var propName in cX.CCE.library){if(cX.CCE.library.hasOwnProperty(propName)){cX.CCE[propName]=cX.CCE.library[propName]}}})();if(!window.cxTest){window.cxTest=cX.CCE}}catch(e){console.log(e)}
//# sourceMappingURL=cx.cce.js.map